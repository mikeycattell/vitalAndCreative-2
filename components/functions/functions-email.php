<?php/** * Returns a formatted header for a HTML email * * @param $title * @return string */function email_header($title){	$email_header = '<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">		<html xmlns:v="urn:schemas-microsoft-com:vml">		<head>			<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">			<title>'.$title.'</title>			<style type="text/css">			</style>		</head>		<body marginheight="0" bgcolor="#DDDDDD" style="margin:0px; padding:0px;">		<table table style="width: 600px; margin: auto;" border="0" cellpadding="20" cellspacing="0" align="center" bgcolor="#FFFFFF">			<tr>				<td width="600">';	return $email_header.get_field('email_header', 'option');}/** *  Returns a formatted footer for a HTML email * * @return string */function email_footer(){	$email_footer = '</td>	</tr>	</table>	</body>	</html>';	return get_field('email_footer', 'option').$email_footer;}/** * A example use of the email functionality */function test_email(){    /****************************************     * Sample jQuery ajax use of this function     ****************************************        $.ajax({            url: base_dir+"/wp-admin/admin-ajax.php",            type:'POST',            data: {                action: 	'test_email',                security: 	'<?php echo wp_create_nonce( "test-email-ajax-nonce" ); ?>'            },            dataType: 'json',            success: function(data){                //Access the returned JSON                console.log(data.message);            }        });	 */	//Setup the returns we will use	$success_data 	= array('success' => true, 'message' => 'Thank you');	$error_data 	= array('success' => false, 'message' => 'There appears to have been a problem, please try again later.');	//Check the nonce not invalid and return the error if it is	if( !check_ajax_referer( 'test-email-ajax-nonce', 'security', false ) ){        wp_send_json($error_data);	}	//Email administrator	$title = 'Test title';	$headers = array('From: ' . get_bloginfo('name') . ' <no-reply@' . clean_site_url() . '>');	$message = '<h1>TEST</h1>';	$message.= '<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Ut consequat tempus eros. Duis fermentum aliquam elit ac rutrum. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Sed ante diam, imperdiet ac ante ut, fringilla maximus felis. Proin commodo elit et dui condimentum, blandit vulputate est rhoncus. Phasellus ultricies nisi sit amet iaculis dignissim. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Nullam et mattis turpis, id efficitur ante. Nam vitae dolor ac metus pulvinar interdum vel nec quam. Etiam in lorem fermentum, feugiat nunc a, porta enim. Cras ac malesuada lorem. Duis semper eleifend libero ac condimentum. </p>';	//Send the email	add_filter('wp_mail_content_type', create_function('', 'return "text/html"; '));	$email = wp_mail(get_bloginfo('admin_email'), $title, email_header($title) . $message . email_footer(), $headers);	remove_filter('wp_mail_content_type', 'set_html_content_type');	//Depending on the email submission, echo the success or failure json data	if( $email ){        wp_send_json($success_data);	} else {        wp_send_json($error_data);	}}add_action('wp_ajax_test_email', 		 	'test_email'); // for logged in useradd_action('wp_ajax_nopriv_test_email', 	'test_email'); // if user not logged in?>